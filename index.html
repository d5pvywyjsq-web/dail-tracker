<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á—ë—Ç—ã</title>
  <style>
    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --text-primary: #212529;
      --text-secondary: #495057;
      --border-color: #dee2e6;
      --card-bg: #ffffff;
      --button-bg: #6a5acd;
      --button-hover: #5a4fcf;
      --accent: #ff6f61;
      --entry-bg: #e6e1ff;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
      --danger-bg: #ff4d4d;
      --danger-hover: #e63939;
    }

    [data-theme="dark"] {
      --bg-primary: #121212;
      --bg-secondary: #1e1e1e;
      --text-primary: #f0f0f0;
      --text-secondary: #b0b0b0;
      --border-color: #333;
      --card-bg: #252525;
      --button-bg: #8a7bff;
      --button-hover: #7a6aff;
      --accent: #ff7e70;
      --entry-bg: #302a4a;
      --shadow: 0 4px 16px rgba(0,0,0,0.3);
      --danger-bg: #ff5f5f;
      --danger-hover: #ff4444;
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      margin: 0;
      padding: 1rem;
      transition: background-color 0.3s;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.2rem;
      flex-wrap: wrap;
    }

    h1 {
      margin: 0;
      font-size: 1.7rem;
      background: linear-gradient(90deg, #6a5acd, #ff6f61);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    #theme-toggle {
      background: var(--button-bg);
      color: white;
      border: none;
      border-radius: 50%;
      width: 42px;
      height: 42px;
      font-size: 1.1rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    section {
      background: var(--card-bg);
      padding: 1.2rem;
      margin-bottom: 1.3rem;
      border-radius: 14px;
      box-shadow: var(--shadow);
    }

    h2 {
      margin-top: 0;
      font-size: 1.35rem;
      font-weight: 600;
    }

    label {
      display: block;
      margin: 0.7rem 0 0.4rem;
      font-weight: 600;
      color: var(--text-secondary);
    }

    input, select {
      width: 100%;
      padding: 0.65rem;
      border: 1px solid var(--border-color);
      border-radius: 10px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 1rem;
    }

    input::placeholder {
      color: var(--text-secondary);
      opacity: 0.7;
    }

    button {
      background: var(--button-bg);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 0.75rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
      width: 100%;
      margin-top: 0.5rem;
    }

    button:hover {
      background: var(--button-hover);
    }

    #clear-all {
      background: var(--danger-bg);
    }

    #clear-all:hover {
      background: var(--danger-hover);
    }

    .product-item, .daily-entry {
      background: var(--entry-bg);
      padding: 1rem;
      border-radius: 12px;
      margin-bottom: 0.8rem;
    }

    .product-title {
      font-weight: 700;
      margin: 0 0 0.3rem;
      color: var(--button-bg);
    }

    .hidden { display: none; }

    .daily-date {
      font-weight: bold;
      color: var(--button-bg);
      margin-bottom: 0.2rem;
    }

    @media (max-width: 600px) {
      header { flex-direction: column; align-items: flex-start; gap: 1rem; }
      h1 { font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <header>
    <h1>üìä –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á—ë—Ç—ã</h1>
    <button id="theme-toggle" aria-label="–°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É">üåì</button>
  </header>

  <main>
    <section id="input-section">
      <h2>‚ûï –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</h2>

      <label for="report-date">üìÖ –î–∞—Ç–∞</label>
      <input type="date" id="report-date">

      <label for="category-select">üóÇÔ∏è –ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
      <select id="category-select">
        <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ ‚Äî</option>
      </select>
      <input type="text" id="new-category" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é" style="margin-top: 0.3rem;">

      <label for="product-select">üçé –ü—Ä–æ–¥—É–∫—Ç</label>
      <select id="product-select" disabled>
        <option value="">‚Äî –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Äî</option>
      </select>
      <input type="text" id="new-product" placeholder="–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç" class="hidden" style="margin-top: 0.3rem;">

      <label for="value">üî¢ –ó–Ω–∞—á–µ–Ω–∏–µ</label>
      <input type="number" id="value" placeholder="0" step="any">

      <button id="add-btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </section>

    <!-- üîπ –ù–û–í–ê–Ø –°–ï–ö–¶–ò–Ø: –ï–ñ–ï–î–ù–ï–í–ù–´–ï –û–¢–ß–Å–¢–´ -->
    <section id="daily-reports">
      <h2>üìÜ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á—ë—Ç—ã</h2>
      <div id="daily-list">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
    </section>

    <section id="products-stats">
      <h2>üìà –í—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
      <div id="products-list">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
    </section>

    <button id="clear-all">üóëÔ∏è –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</button>
  </main>

  <script>
    // === –¢–µ–º–∞ ===
    const themeToggle = document.getElementById('theme-toggle');
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    themeToggle.textContent = savedTheme === 'light' ? 'üåì' : 'üåï';
    themeToggle.addEventListener('click', () => {
      const newTheme = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      themeToggle.textContent = newTheme === 'light' ? 'üåì' : 'üåï';
    });

    // === –î–∞—Ç–∞ —Å–µ–≥–æ–¥–Ω—è ===
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('report-date').value = today;

    // === –î–∞–Ω–Ω—ã–µ ===
    let reports = JSON.parse(localStorage.getItem('dailyReports')) || [];

    function saveReports() {
      localStorage.setItem('dailyReports', JSON.stringify(reports));
    }

    // === –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ===
    function getUniqueCategories() {
      return [...new Set(reports.map(r => r.category))].sort();
    }

    function getProductsInCategory(category) {
      return [...new Set(reports.filter(r => r.category === category).map(r => r.product))].sort();
    }

    // === –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ ===
    function updateCategorySelect() {
      const select = document.getElementById('category-select');
      select.innerHTML = '<option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ ‚Äî</option>';
      getUniqueCategories().forEach(cat => {
        const opt = document.createElement('option');
        opt.value = cat;
        opt.textContent = cat;
        select.appendChild(opt);
      });
    }

    function updateProductSelect(category) {
      const select = document.getElementById('product-select');
      const newProductInput = document.getElementById('new-product');
      if (!category) {
        select.innerHTML = '<option value="">‚Äî –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Äî</option>';
        select.disabled = true;
        newProductInput.classList.add('hidden');
        return;
      }
      select.disabled = false;
      select.innerHTML = '<option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ ‚Äî</option>';
      getProductsInCategory(category).forEach(prod => {
        const opt = document.createElement('option');
        opt.value = prod;
        opt.textContent = prod;
        select.appendChild(opt);
      });
      newProductInput.classList.remove('hidden');
    }

    // === –†–µ–Ω–¥–µ—Ä –ï–ñ–ï–î–ù–ï–í–ù–´–• –û–¢–ß–Å–¢–û–í ===
    function renderDailyReports() {
      const container = document.getElementById('daily-list');
      if (reports.length === 0) {
        container.textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
        return;
      }

      // –°–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ –¥–∞—Ç–µ –∏ –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—É–º–º—É
      const dailyTotals = {};
      reports.forEach(r => {
        if (!dailyTotals[r.date]) dailyTotals[r.date] = 0;
        dailyTotals[r.date] += Number(r.value);
      });

      container.innerHTML = '';
      Object.keys(dailyTotals)
        .sort((a, b) => new Date(b) - new Date(a)) // –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É
        .forEach(date => {
          const total = dailyTotals[date].toFixed(2);
          const [y, m, d] = date.split('-');
          const formatted = `${d}.${m}`;

          const div = document.createElement('div');
          div.className = 'daily-entry';
          div.innerHTML = `<div class="daily-date">${formatted}</div>–û–±—â–∞—è —Å—É–º–º–∞: ${total}`;
          container.appendChild(div);
        });
    }

    // === –†–µ–Ω–¥–µ—Ä –°–¢–ê–¢–ò–°–¢–ò–ö–ò –ü–û –ü–†–û–î–£–ö–¢–ê–ú ===
    function renderProductsStats() {
      const container = document.getElementById('products-list');
      if (reports.length === 0) {
        container.textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
        return;
      }

      const grouped = {};
      reports.forEach(r => {
        if (!grouped[r.category]) grouped[r.category] = {};
        if (!grouped[r.category][r.product]) grouped[r.category][r.product] = [];
        grouped[r.category][r.product].push(r);
      });

      container.innerHTML = '';
      for (const category in grouped) {
        const catHeader = document.createElement('h3');
        catHeader.textContent = `üóÇÔ∏è ${category}`;
        catHeader.style.marginTop = '1.2rem';
        catHeader.style.marginBottom = '0.6rem';
        catHeader.style.color = 'var(--text-primary)';
        container.appendChild(catHeader);

        for (const product in grouped[category]) {
          const data = grouped[category][product];
          const total = data.reduce((sum, r) => sum + Number(r.value), 0);
          const lastEntry = data.reduce((latest, r) => r.date > latest.date ? r : latest, data[0]);

          const div = document.createElement('div');
          div.className = 'product-item';
          div.innerHTML = `
            <div class="product-title">${product}</div>
            <p>–í—Å–µ–≥–æ: ${total.toFixed(2)} ‚Ä¢ –ü–æ—Å–ª–µ–¥–Ω–µ–µ: ${lastEntry.value} (${lastEntry.date.split('-').slice(1).join('.')})</p>
          `;
          container.appendChild(div);
        }
      }
    }

    // === –°–æ–±—ã—Ç–∏—è –ø–æ–ª–µ–π ===
    document.getElementById('category-select').addEventListener('change', function() {
      const category = this.value;
      updateProductSelect(category);
    });

    document.getElementById('new-category').addEventListener('input', function() {
      if (this.value.trim()) {
        document.getElementById('category-select').value = '';
        updateProductSelect(this.value.trim());
      } else {
        updateProductSelect(document.getElementById('category-select').value);
      }
    });

    // === –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ ===
    document.getElementById('add-btn').addEventListener('click', () => {
      const date = document.getElementById('report-date').value;
      const selectedCategory = document.getElementById('category-select').value;
      const newCategory = document.getElementById('new-category').value.trim();
      const selectedProduct = document.getElementById('product-select').value;
      const newProduct = document.getElementById('new-product').value.trim();
      const value = parseFloat(document.getElementById('value').value);

      const category = newCategory || selectedCategory;
      const product = newProduct || selectedProduct;

      if (!date || !category || !product || isNaN(value)) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.');
        return;
      }

      reports.push({ date, category, product, value });
      saveReports();
      updateCategorySelect();
      renderDailyReports();
      renderProductsStats();

      // –°–±—Ä–æ—Å —Ñ–æ—Ä–º
      document.getElementById('value').value = '';
      document.getElementById('new-category').value = '';
      document.getElementById('new-product').value = '';
      document.getElementById('category-select').value = '';
      document.getElementById('product-select').innerHTML = '<option value="">‚Äî –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é ‚Äî</option>';
      document.getElementById('product-select').disabled = true;
      document.getElementById('new-product').classList.add('hidden');
    });

    // === –ö–ù–û–ü–ö–ê –û–ß–ò–°–¢–ö–ò ===
    document.getElementById('clear-all').addEventListener('click', () => {
      if (confirm('‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–Æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        reports = [];
        saveReports();
        updateCategorySelect();
        renderDailyReports();
        renderProductsStats();
        alert('–í—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∞.');
      }
    });

    // === –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
    updateCategorySelect();
    renderDailyReports();
    renderProductsStats();
  </script>
</body>
</html>
